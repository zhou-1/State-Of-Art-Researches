## CLEAN EMBEDDED ARCHITECTURE 整洁的嵌入式架构     

“虽然软件本身并不会随时间推移而磨损，但硬件及其固件却会随时间推移而过时，随即也需要对软件做相应改动。”    
其中，软件（software）应该是一种使用周期很长的东西，而固件（firmware）则会随着硬件演进而淘汰过时。    
“虽然软件质量本身并不会随时间推移而损耗，但是未妥善管理的硬件依赖和固件依赖却是软件的头号杀手。”     

       
固件并不一定是存储在 ROM 中的代码。固件也不是依据其存储的位置来定义的，而是由其代码的依赖关系，及其随着硬件的演进在变更难度上的变化来定义的。     
Kent Beck 描述了软件构建过程中的三个阶段（引号部分是他的原话，楷体部分是我的注解）：    
1. “先让代码工作起来”——如果代码不能工作，就不能产生价值。   
2. “然后再试图将它变好——通过对代码进行重构，让我们自己和其他人更好地理解代码，并能按照需求不断地修改代码。    
3. “最后再试着让它运行得更快”——按照性能提升的“需求”来重构代码。       

      
      
### THE TARGET-HARDWARE BOTTLENECK 目标硬件瓶颈      
标硬件瓶颈（target-hardware bottleneck）是嵌入式开发所特有的一个问题，如果我们没有采用某种清晰的架构来设计嵌入式系统的代码结构，就经常会面临只能在目标系统平台上测试代码的难题。如果只能在特定的平台上测试代码，那么这一定会拖慢项目的开发进度。     
Layers 分层      
The Hardware Is a Detail 硬件是实现细节    
DON’T REVEAL HARDWARE DETAILS TO THE USER OF THE HAL 不要向 HAL 的用户暴露硬件细节    
The Processor Is a Detail     
The Operating System Is a Detail 操作系统是实现细节     
PROGRAMMING TO INTERFACES AND SUBSTITUTABILITY 面向接口编程与可替代性     
分层架构的理念是基于接口编程的理念来设计的。当模块之间能以接口形式交互时，我们就可以将一个服务替换成另外一个服务。     
DRY CONDITIONAL COMPILATION DIRECTIVES DRY 条件性编译命令     

       
嵌入式编程人员应该多学习一些非嵌入式系统的编程经验。     
为了让我们的产品能长期地保持健康，请别让你的代码都变成固件。如果一个系统的代码只能在目标硬件上测试，那么它的开发过程会变得非常艰难。总之，为产品的长期健康着想而采用一套整洁的嵌入式架构是很有必要的。     






